

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/laptop.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
  <title>dingTalk - Robin Liu&#39;s Blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.7.2/styles/github-gist.min.css" />
    
  

  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.11","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 60vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Robin Liu's Blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/zima%20blue.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="dingTalk">
              
            </span>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      <div class="container nopadding-x-md">
        <div class="py-5" id="board"
          >
          
          <div class="container">
            <div class="row">
              <div class="col-12 col-md-10 m-auto">
                

<article class="page-content">
  <h2 id="未竟"><a href="#未竟" class="headerlink" title="未竟"></a>未竟</h2><p>项目调试常用命令：项目文件夹，内容待分类</p>
<h3 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h3><p>debugger：<a target="_blank" rel="noopener" href="http://eslint.cn/docs/rules/no-debugger">http://eslint.cn/docs/rules/no-debugger</a></p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> eslint-disable-<span class="hljs-keyword">next</span>-line no-debugger<br><span class="hljs-regexp">//</span> debugger<br></code></pre></td></tr></table></figure>



<h4 id="style"><a href="#style" class="headerlink" title="style"></a>style</h4><p>scope !important</p>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/css/css-important.html">https://www.runoob.com/css/css-important.html</a></p>
<h4 id="细节"><a href="#细节" class="headerlink" title="细节"></a>细节</h4><p>js undefined和null的区别：在下载文件夹</p>
<p>js === ==区别：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/yongzhu/p/14609757.html">https://www.cnblogs.com/yongzhu/p/14609757.html</a></p>
<h3 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h3><p>此处应有可跳转目录</p>
<h4 id="git"><a href="#git" class="headerlink" title="git"></a>git</h4><p>git stash：<a target="_blank" rel="noopener" href="https://blog.csdn.net/misakaqunianxiatian/article/details/51103734%E3%80%81https://blog.csdn.net/syousetu/article/details/107764123?spm=1001.2101.3001.6650.2&amp;utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-2.no_search_link&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-2.no_search_link%E3%80%81https://www.cnblogs.com/zndxall/archive/2018/09/04/9586088.html">https://blog.csdn.net/misakaqunianxiatian/article/details/51103734、https://blog.csdn.net/syousetu/article/details/107764123?spm=1001.2101.3001.6650.2&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-2.no_search_link&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-2.no_search_link、https://www.cnblogs.com/zndxall/archive/2018/09/04/9586088.html</a></p>
<h3 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h3><p>数据库日期转换：<a target="_blank" rel="noopener" href="https://blog.csdn.net/jimlong/article/details/7346970">https://blog.csdn.net/jimlong/article/details/7346970</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/keeya/p/11563786.html#:~:text=%E5%88%A9%E7%94%A8Stream%20API%20%E4%B8%AD%E7%9A%84,filter%E5%B0%86%E9%98%9F%E5%88%97%E4%B8%AD%E7%9A%84%E7%A9%BA%E5%AF%B9%E8%B1%A1%E8%BF%87%E6%BB%A4%E6%8E%89%EF%BC%8Cfilter%20%28Objects%3A%3AnonNull%29%E7%9A%84%E6%84%8F%E6%80%9D%E6%98%AF%EF%BC%8Clist%E4%B8%AD%E7%9A%84%E6%AF%8F%E4%B8%AA%E5%85%83%E7%B4%A0%E6%89%A7%E8%A1%8CObjects%E7%9A%84nonNull%20%28%29%E6%96%B9%E6%B3%95%EF%BC%8C%E8%BF%94%E5%9B%9Efalse%E7%9A%84%E5%85%83%E7%B4%A0%E8%A2%AB%E8%BF%87%E6%BB%A4%E6%8E%89%EF%BC%8C%E4%BF%9D%E7%95%99%E8%BF%94%E5%9B%9Etrue%E7%9A%84%E5%85%83%E7%B4%A0%E3%80%82">https://www.cnblogs.com/keeya/p/11563786.html#:~:text=%E5%88%A9%E7%94%A8Stream%20API%20%E4%B8%AD%E7%9A%84,filter%E5%B0%86%E9%98%9F%E5%88%97%E4%B8%AD%E7%9A%84%E7%A9%BA%E5%AF%B9%E8%B1%A1%E8%BF%87%E6%BB%A4%E6%8E%89%EF%BC%8Cfilter%20%28Objects%3A%3AnonNull%29%E7%9A%84%E6%84%8F%E6%80%9D%E6%98%AF%EF%BC%8Clist%E4%B8%AD%E7%9A%84%E6%AF%8F%E4%B8%AA%E5%85%83%E7%B4%A0%E6%89%A7%E8%A1%8CObjects%E7%9A%84nonNull%20%28%29%E6%96%B9%E6%B3%95%EF%BC%8C%E8%BF%94%E5%9B%9Efalse%E7%9A%84%E5%85%83%E7%B4%A0%E8%A2%AB%E8%BF%87%E6%BB%A4%E6%8E%89%EF%BC%8C%E4%BF%9D%E7%95%99%E8%BF%94%E5%9B%9Etrue%E7%9A%84%E5%85%83%E7%B4%A0%E3%80%82</a></p>
<p>foreach：<a target="_blank" rel="noopener" href="https://www.twle.cn/c/yufei/java8/java8-basic-iterator-foreach.html">https://www.twle.cn/c/yufei/java8/java8-basic-iterator-foreach.html</a></p>
<p>字符串拼接：<a target="_blank" rel="noopener" href="https://www.html.cn/softprog/java/190778.html">https://www.html.cn/softprog/java/190778.html</a></p>
<p>json list格式转换：<a target="_blank" rel="noopener" href="https://blog.csdn.net/xialong_927/article/details/81872422">https://blog.csdn.net/xialong_927/article/details/81872422</a></p>
<p>创建文件夹：<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1703460">https://cloud.tencent.com/developer/article/1703460</a></p>
<p>spi机制：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/46b42f7f593c%E3%80%81https://blog.csdn.net/Love667767/article/details/106422787%E3%80%81https://www.jianshu.com/p/3a3edbcd8f24%E3%80%81https://zhuanlan.zhihu.com/p/84337883">https://www.jianshu.com/p/46b42f7f593c、https://blog.csdn.net/Love667767/article/details/106422787、https://www.jianshu.com/p/3a3edbcd8f24、https://zhuanlan.zhihu.com/p/84337883</a></p>
<p>apt：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_20521573/article/details/82321755%E3%80%81https://liuyehcf.github.io/2018/02/02/Java-JSR-269-%E6%8F%92%E5%85%A5%E5%BC%8F%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8/%E3%80%81https://blog.csdn.net/doc_sgl/article/details/50367083">https://blog.csdn.net/qq_20521573/article/details/82321755、https://liuyehcf.github.io/2018/02/02/Java-JSR-269-%E6%8F%92%E5%85%A5%E5%BC%8F%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8/、https://blog.csdn.net/doc_sgl/article/details/50367083</a></p>
<h3 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> <span class="hljs-type">name</span> <span class="hljs-keyword">FROM</span> sysobjects <span class="hljs-keyword">WHERE</span> id <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> id <span class="hljs-keyword">FROM</span> syscolumns <span class="hljs-keyword">WHERE</span> <span class="hljs-type">name</span> = <span class="hljs-string">&#x27;destroyDT&#x27;</span>)<br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/41695440/java-hibernate-createsqlquery-using-addentity">https://stackoverflow.com/questions/41695440/java-hibernate-createsqlquery-using-addentity</a></p>
<p>调用setter异常：<a target="_blank" rel="noopener" href="https://www.itbaoku.cn/post/741580/How-do-I-cure-the-cause-of-Hibernate-exception-quotIllegalArgumentException-occurred-while-calling-setterquot">https://www.itbaoku.cn/post/741580/How-do-I-cure-the-cause-of-Hibernate-exception-quotIllegalArgumentException-occurred-while-calling-setterquot</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java">String resSql = <span class="hljs-string">&quot;select ir.invoiceRequestGuid,\n&quot;</span> +<br>                    <span class="hljs-string">&quot;       invoiceRequestNo,\n&quot;</span> +<br>                    <span class="hljs-string">&quot;       invoiceNo,\n&quot;</span> +<br>                    <span class="hljs-string">&quot;       ir.requestMoney,\n&quot;</span> +<br>                    <span class="hljs-string">&quot;       requestStatus,\n&quot;</span> +<br>                    <span class="hljs-string">&quot;       ir.companyGuid,\n&quot;</span> +<br>                    <span class="hljs-string">&quot;       invoiceType,\n&quot;</span> +<br>                    <span class="hljs-string">&quot;       invoiceTaxType,\n&quot;</span> +<br>                    <span class="hljs-string">&quot;       invoiceTitleGuid,\n&quot;</span> +<br>                    <span class="hljs-string">&quot;       ir.invoiceTitle,\n&quot;</span> +<br>                    <span class="hljs-string">&quot;       invoiceTaxNo,\n&quot;</span> +<br>                    <span class="hljs-string">&quot;       convert(varchar(20), ir.expectDT, 20)         as expectDT,\n&quot;</span> +<br>                    <span class="hljs-string">&quot;       needValidation,\n&quot;</span> +<br>                    <span class="hljs-string">&quot;       notContinuity,\n&quot;</span> +<br>                    <span class="hljs-string">&quot;       skipNum,\n&quot;</span> +<br>                    <span class="hljs-string">&quot;       cast(needInvMemo as int) as needInvMemo,\n&quot;</span> +<br>                    <span class="hljs-string">&quot;       memo,\n&quot;</span> +<br>                    <span class="hljs-string">&quot;       convert(varchar(20), ir.createDT, 20)         as createDT,\n&quot;</span> +<br>                    <span class="hljs-string">&quot;       ir.creator,\n&quot;</span> +<br>                    <span class="hljs-string">&quot;       convert(varchar(20), ir.updateDT, 20)         as updateDT,\n&quot;</span> +<br>                    <span class="hljs-string">&quot;       updater,\n&quot;</span> +<br>                    <span class="hljs-string">&quot;       convert(varchar(20), ir.submitDT, 20)         as submitDT,\n&quot;</span> +<br>                    <span class="hljs-string">&quot;       submitter,\n&quot;</span> +<br>                    <span class="hljs-string">&quot;       convert(varchar(20), ir.invoiceBillingDT, 20)         as invoiceBillingDT,\n&quot;</span> +<br>                    <span class="hljs-string">&quot;       needInvoice,\n&quot;</span> +<br>                    <span class="hljs-string">&quot;       eInvoiceUrl,\n&quot;</span> +<br>                    <span class="hljs-string">&quot;       cast(needInvoiceCheckList as int) as needInvoiceCheckList,\n&quot;</span> +<br>                    <span class="hljs-string">&quot;       dingTalkApprovalNo,\n&quot;</span> +<br>                    <span class="hljs-string">&quot;       cast(invoiceTitleType as int) as invoiceTitleType,\n&quot;</span> +<br>                    <span class="hljs-string">&quot;       syncK3Status,\n&quot;</span> +<br>                    <span class="hljs-string">&quot;       syncK3Message,\n&quot;</span> +<br>                    <span class="hljs-string">&quot;       cast(isSupportElectronicInvoice as int) as isSupportElectronicInvoice\n&quot;</span> +<br>                    <span class="hljs-string">&quot;from tbInvoiceRequest ir with (nolock)\n&quot;</span> +<br>                    <span class="hljs-string">&quot;         left join tbEnterprise ep with (nolock) on ep.enterpriseGuid = ir.InvoiceTitleGuid\n&quot;</span> +<br>                    <span class="hljs-string">&quot;where ir.invoiceRequestGuid in (:ids) order by createDT desc&quot;</span>;<br>            List&lt;BInvoiceRequest&gt; requests = (List&lt;BInvoiceRequest&gt;) session.createSQLQuery(resSql)<br>                    .setResultTransformer(<span class="hljs-keyword">new</span> AliasToBeanResultTransformer(BInvoiceRequest.class))<br>                    .setParameterList(<span class="hljs-string">&quot;ids&quot;</span>, requestGuids)<br>                    .list();<br></code></pre></td></tr></table></figure>





<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><code class="hljs java">﻿<span class="hljs-keyword">package</span> cn.com.genechem.genemtx.domain;<br><br><span class="hljs-keyword">import</span> cn.com.genechem.gcapi.Json;<br><span class="hljs-keyword">import</span> cn.com.genechem.genehub.GeneHubApi;<br><span class="hljs-keyword">import</span> cn.com.genechem.genemtx.utils.FileUtil;<br><span class="hljs-keyword">import</span> cn.com.genechem.gesource.GesourceException;<br><span class="hljs-keyword">import</span> cn.com.genechem.gesource.GesourcePrincipal;<br><span class="hljs-keyword">import</span> cn.com.genechem.gesource.Resources;<br><span class="hljs-keyword">import</span> cn.com.genechem.gesource.ServiceContext;<br><span class="hljs-keyword">import</span> jakarta.inject.Inject;<br><span class="hljs-keyword">import</span> jakarta.ws.rs.*;<br><span class="hljs-keyword">import</span> jakarta.ws.rs.core.MediaType;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.glassfish.jersey.media.multipart.FormDataParam;<br><span class="hljs-keyword">import</span> org.hibernate.Session;<br><br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.InputStream;<br><span class="hljs-keyword">import</span> java.net.URLDecoder;<br><span class="hljs-keyword">import</span> java.nio.file.Files;<br><span class="hljs-keyword">import</span> java.nio.file.StandardCopyOption;<br><span class="hljs-keyword">import</span> java.util.*;<br><br><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> cn.com.genechem.genehub.GeneHubApi.GENE_MATRIX_PATH;<br><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> cn.com.genechem.genehub.GeneHubApi.HOME_BASE_PATH;<br><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> cn.com.genechem.genemtx.domain.SysDictionary.*;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Path(&quot;/projects/&#123;projectId&#125;/project-files&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProjectFiles</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Resources</span> </span>&#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String RAW_DATA_SUFFIX = <span class="hljs-string">&quot;/raw-data/&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String ATTACHMENTS_SUFFIX = <span class="hljs-string">&quot;/attachments/&quot;</span>;<br><br>    <span class="hljs-meta">@Inject</span><br>    ServiceContext context;<br><br>    <span class="hljs-meta">@POST</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">creteProjectFiles</span><span class="hljs-params">(Collection&lt;ProjectFile&gt; projectFiles)</span> </span>&#123;<br>        log.info(<span class="hljs-string">&quot;文件数据：&quot;</span> + Json.toJson(projectFiles));<br>        <span class="hljs-keyword">if</span> (projectFiles == <span class="hljs-keyword">null</span> || projectFiles.size() == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> GesourceException(<span class="hljs-string">&quot;没有传递文件信息&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">for</span> (ProjectFile projectFile : projectFiles) &#123;<br>            context.getCurrentPersistence().persist(projectFile);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * labtime交付文件</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GET</span><br>    <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;ProjectFile&gt; <span class="hljs-title">getLabtimeRawData</span><span class="hljs-params">(<span class="hljs-meta">@PathParam(&quot;projectId&quot;)</span> String projectId)</span> </span>&#123;<br>        Session session = context.getCurrentPersistence();<br>        String sql = <span class="hljs-string">&quot;select * from tbProjectFile where ProjectId = (:ProjectId)\n&quot;</span> +<br>                <span class="hljs-string">&quot;  and FileUsage = (:FileUsage) and Source = (:Source)&quot;</span>;<br>        <span class="hljs-keyword">return</span> (List&lt;ProjectFile&gt;) session.createSQLQuery(sql).addEntity(ProjectFile.class)<br>                .setParameter(<span class="hljs-string">&quot;ProjectId&quot;</span>, projectId)<br>                .setParameter(<span class="hljs-string">&quot;FileUsage&quot;</span>, PROJECT_FILE_USAGE_RAW)<br>                .setParameter(<span class="hljs-string">&quot;Source&quot;</span>, PROJECT_SOURCE_LT).list();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 单文件上传</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@POST</span><br>    <span class="hljs-meta">@Consumes(MediaType.MULTIPART_FORM_DATA)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ProjectFile <span class="hljs-title">uploadFile</span><span class="hljs-params">(<span class="hljs-meta">@PathParam(&quot;projectId&quot;)</span> String projectId, <span class="hljs-meta">@FormDataParam(&quot;usage&quot;)</span> Integer usage,</span></span><br><span class="hljs-params"><span class="hljs-function">                                  <span class="hljs-meta">@FormDataParam(&quot;file&quot;)</span> InputStream file, <span class="hljs-meta">@FormDataParam(&quot;fileName&quot;)</span> String fName</span></span><br><span class="hljs-params"><span class="hljs-function">    )</span> </span>&#123;<br>        GesourcePrincipal principal = context.getUserPrincipal();<br>        Session session = context.getCurrentPersistence();<br>        <span class="hljs-keyword">try</span> &#123;<br>            String fileName = URLDecoder.decode(fName, <span class="hljs-string">&quot;UTF-8&quot;</span>);<br>            String databasePath = getDatabasePath(usage, principal.getUserNo(), projectId) + fileName;<br>            String localPath = GeneHubApi.toLocalPath(databasePath, principal.getInstitutionNo());<br>            File toFile = FileUtil.writeToFile(file, localPath);<br><br>            ProjectFile projectFile = <span class="hljs-keyword">new</span> ProjectFile();<br>            projectFile.setProjectFileId(UUID.randomUUID().toString());<br>            projectFile.setProjectId(projectId);<br>            projectFile.setFileUsage(usage);<br>            projectFile.setDisplayName(fileName);<br>            projectFile.setGchubPath(databasePath);<br>            projectFile.setSource(PROJECT_SOURCE_GX);<br>            projectFile.setCreateDT(Calendar.getInstance());<br>            projectFile.setCreatorName(principal.getName());<br>            projectFile.setCreatorNo(principal.getUserNo());<br>            projectFile.setSize(toFile.length());<br>            session.save(projectFile);<br>            <span class="hljs-keyword">return</span> projectFile;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> GesourceException(e.getMessage());<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@PATCH</span><br>    <span class="hljs-meta">@Path(&quot;/op/delete-files&quot;)</span><br>    <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteFiles</span><span class="hljs-params">(<span class="hljs-meta">@PathParam(&quot;projectId&quot;)</span> String projectId, String fileIdList)</span> </span>&#123;<br>        GesourcePrincipal principal = context.getUserPrincipal();<br>        Session session = context.getCurrentPersistence();<br>        String analysisListSql = <span class="hljs-string">&quot;select tA.* from tbAnalysis tA\n&quot;</span> +<br>                <span class="hljs-string">&quot;         left join tbProject tP on tP.ProjectId = tA.ProjectId\n&quot;</span> +<br>                <span class="hljs-string">&quot;where tP.ProjectId = (:projectId)&quot;</span>;<br>        List&lt;Analysis&gt; analysisList = (List&lt;Analysis&gt;) session.createSQLQuery(analysisListSql)<br>                .addEntity(Analysis.class).setParameter(<span class="hljs-string">&quot;projectId&quot;</span>, projectId).list();<br>        <span class="hljs-keyword">if</span> (analysisList.size() &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> GesourceException(<span class="hljs-string">&quot;该Project包含Analysis，不能删除文件&quot;</span>);<br>        &#125;<br><br>        String fileListSql = <span class="hljs-string">&quot;select * from tbProjectFile where ProjectFileId in (:fileIdList)&quot;</span>;<br>        List&lt;ProjectFile&gt; projectFileList = (List&lt;ProjectFile&gt;) session.createSQLQuery(fileListSql)<br>                .addEntity(ProjectFile.class).setParameterList(<span class="hljs-string">&quot;fileIdList&quot;</span>, fileIdList.split(<span class="hljs-string">&quot;,&quot;</span>)).list();<br>        projectFileList.forEach(projectFile -&gt; &#123;<br>            <span class="hljs-keyword">if</span> (projectFile.getSource().equals(PROJECT_SOURCE_LT)) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> GesourceException(projectFile.getDisplayName() + <span class="hljs-string">&quot;非本地上传，不能删除&quot;</span>);<br>            &#125;<br>            String localPath = GeneHubApi.toLocalPath(projectFile.getGchubPath(), principal.getInstitutionNo());<br>            File file = <span class="hljs-keyword">new</span> File(localPath);<br>            <span class="hljs-keyword">if</span> (!file.exists()) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> GesourceException(projectFile.getDisplayName() + <span class="hljs-string">&quot;不存在&quot;</span>);<br>            &#125;<br>            file.delete();<br>            session.delete(projectFile);<br>        &#125;);<br>    &#125;<br><br>    <span class="hljs-meta">@GET</span><br>    <span class="hljs-meta">@Path(&quot;/download-file/&#123;fileId&#125;/&#123;fileName&#125;&quot;)</span><br>    <span class="hljs-meta">@Produces(MediaType.APPLICATION_OCTET_STREAM)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> File <span class="hljs-title">downloadFile</span><span class="hljs-params">(<span class="hljs-meta">@PathParam(&quot;fileId&quot;)</span> String fileId)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        GesourcePrincipal principal = context.getUserPrincipal();<br>        Session session = context.getCurrentPersistence();<br>        ProjectFile projectFile = (ProjectFile) session.createSQLQuery(<span class="hljs-string">&quot;select * from tbProjectFile &quot;</span> +<br>                        <span class="hljs-string">&quot;where ProjectFileId = (:fileId)&quot;</span>).addEntity(ProjectFile.class)<br>                .setParameter(<span class="hljs-string">&quot;fileId&quot;</span>, fileId).uniqueResult();<br>        String localPath = GeneHubApi.toLocalPath(projectFile.getGchubPath(), principal.getInstitutionNo());<br>        File localFile = <span class="hljs-keyword">new</span> File(localPath);<br>        <span class="hljs-keyword">if</span> (localFile.isDirectory()) &#123;<br>            LinkedList&lt;String&gt; filePathList = FileUtil.readFilesByDir(localFile.getAbsolutePath());<br>            String tempPath = System.getProperty(<span class="hljs-string">&quot;java.io.tmpdir&quot;</span>) + <span class="hljs-string">&quot;/&quot;</span> + localFile.getName();<br>            File dir = <span class="hljs-keyword">new</span> File(tempPath);<br>            dir.mkdirs();<br>            String zipPath = System.getProperty(<span class="hljs-string">&quot;java.io.tmpdir&quot;</span>);<br>            <span class="hljs-keyword">for</span> (String path : filePathList) &#123;<br>                File file = <span class="hljs-keyword">new</span> File(path);<br>                String temp = tempPath + path.substring(path.lastIndexOf(localFile.getName()) + localFile.getName().length(),<br>                        path.lastIndexOf(<span class="hljs-string">&quot;/&quot;</span>) + <span class="hljs-number">1</span>) + file.getName();<br>                <span class="hljs-keyword">if</span> (file.isFile()) &#123;<br>                    <span class="hljs-comment">// 传入文件 先生成其上层目录</span><br>                    String tempDir = path.substring(<span class="hljs-number">0</span>, path.lastIndexOf(<span class="hljs-string">&quot;/&quot;</span>) + <span class="hljs-number">1</span>);<br>                    File tempFile = <span class="hljs-keyword">new</span> File(tempDir);<br>                    tempFile.mkdirs();<br>                &#125;<br>                <span class="hljs-comment">// 不论文件夹还是文件 都需要先在目标位置创建 否则Files.copy会报错</span><br>                File tempFile = <span class="hljs-keyword">new</span> File(temp);<br>                <span class="hljs-keyword">if</span> (!tempFile.exists()) &#123;<br>                    <span class="hljs-keyword">if</span> (file.isDirectory()) &#123;<br>                        tempFile.mkdirs();<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        tempFile.createNewFile();<br>                    &#125;<br>                &#125;<br>                Files.copy(file.toPath(), tempFile.toPath(), StandardCopyOption.REPLACE_EXISTING);<br>            &#125;<br>            File temp = <span class="hljs-keyword">new</span> File(tempPath);<br>            String zipName = FileUtil.compressedFiles(temp, zipPath);<br>            FileUtil.deleteFile(temp);<br>            String filePath = System.getProperty(<span class="hljs-string">&quot;java.io.tmpdir&quot;</span>) + <span class="hljs-string">&quot;/&quot;</span> + zipName;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> File(filePath);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> File(localPath);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * genematrix用户上传数据路径</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> usage     用途</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> userId    原始数据</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> projectId 附件</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 数据库存储路径</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">getDatabasePath</span><span class="hljs-params">(Integer usage, String userId, String projectId)</span> </span>&#123;<br>        String databasePath = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">if</span> (usage.equals(PROJECT_FILE_USAGE_RAW)) &#123;<br>            databasePath = HOME_BASE_PATH + <span class="hljs-string">&quot;/&quot;</span> + userId + RAW_DATA_SUFFIX;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (usage.equals(PROJECT_FILE_USAGE_SAMPLE) || usage.equals(PROJECT_FILE_USAGE_OTHER)) &#123;<br>            databasePath = GENE_MATRIX_PATH + <span class="hljs-string">&quot;/&quot;</span> + projectId + ATTACHMENTS_SUFFIX;<br>        &#125;<br>        <span class="hljs-keyword">return</span> databasePath;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">﻿package cn.com.genechem.genemtx.domain;<br><br>import cn.com.genechem.genehub.GeneHubApi;<br>import cn.com.genechem.genemtx.utils.FileUtil;<br>import cn.com.genechem.gesource.GesourcePrincipal;<br>import cn.com.genechem.gesource.Resources;<br>import cn.com.genechem.gesource.ServiceContext;<br>import jakarta.inject.Inject;<br>import jakarta.ws.rs.*;<br>import jakarta.ws.rs.core.MediaType;<br>import lombok.extern.slf4j.Slf4j;<br><br>import java.io.File;<br>import java.nio.file.Files;<br>import java.nio.file.StandardCopyOption;<br>import java.util.ArrayList;<br>import java.util.List;<br><br>import static cn.com.genechem.genehub.GeneHubApi.GENE_MATRIX_PATH;<br><br>@Slf4j<br>@<span class="hljs-constructor">Path(<span class="hljs-string">&quot;projects/&#123;projectId&#125;/analyses/&#123;analysisId&#125;/analysis-files&quot;</span>)</span><br>public <span class="hljs-keyword">class</span> AnalysisFiles implements Resources &#123;<br><br>    public static final Integer GENEMTX_INPUT = <span class="hljs-number">1</span>;<br>    public static final Integer GENEMTX_RESULT = <span class="hljs-number">2</span>;<br><br>    public static final String RESULT_FILES_SUFFIX = <span class="hljs-string">&quot;output/delivery/&quot;</span>;<br><br>    @Inject<br>    ServiceContext context;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * genemtx获取结果文件</span><br><span class="hljs-comment">     * $GENE_MATRIX/$&#123;projectId&#125;/$&#123;analysisId&#125;</span><br><span class="hljs-comment">     */</span><br>    @GET<br>    @<span class="hljs-constructor">Path(<span class="hljs-string">&quot;/get-result-files&quot;</span>)</span><br>    public List&lt;AnalysisFile&gt; get<span class="hljs-constructor">ResultFiles(@PathParam(<span class="hljs-string">&quot;projectId&quot;</span>)</span> String projectId,<br>                                             @<span class="hljs-constructor">PathParam(<span class="hljs-string">&quot;analysisId&quot;</span>)</span> String analysisId) &#123;<br>        String path = get<span class="hljs-constructor">LocalPath(GENEMTX_RESULT, <span class="hljs-params">projectId</span>, <span class="hljs-params">analysisId</span>)</span>;<br>        return read<span class="hljs-constructor">AnalysisFiles(<span class="hljs-params">path</span>)</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * genemtx选择输入文件 &amp; labtime交付文件</span><br><span class="hljs-comment">     * $GENE_MATRIX/$&#123;projectId&#125;/$&#123;analysisId&#125;/output/delivery</span><br><span class="hljs-comment">     */</span><br>    @GET<br>    @<span class="hljs-constructor">Path(<span class="hljs-string">&quot;/get-input-files&quot;</span>)</span><br>    public List&lt;AnalysisFile&gt; get<span class="hljs-constructor">InputFiles(@PathParam(<span class="hljs-string">&quot;projectId&quot;</span>)</span> String projectId,<br>                                            @<span class="hljs-constructor">PathParam(<span class="hljs-string">&quot;analysisId&quot;</span>)</span> String analysisId) &#123;<br>        String path = get<span class="hljs-constructor">LocalPath(GENEMTX_INPUT, <span class="hljs-params">projectId</span>, <span class="hljs-params">analysisId</span>)</span>;<br>        return read<span class="hljs-constructor">AnalysisFiles(<span class="hljs-params">path</span>)</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 打包下载结果文件</span><br><span class="hljs-comment">     */</span><br>    @PATCH<br>    @<span class="hljs-constructor">Path(<span class="hljs-string">&quot;/op/package-files&quot;</span>)</span><br>    public String package<span class="hljs-constructor">ResultFiles(@PathParam(<span class="hljs-string">&quot;analysisId&quot;</span>)</span> String analysisId, String filePaths) throws Exception &#123;<br>        GesourcePrincipal principal = context.get<span class="hljs-constructor">UserPrincipal()</span>;<br>        String<span class="hljs-literal">[]</span> paths = filePaths.split(<span class="hljs-string">&quot;,&quot;</span>);<br>        String tempPath = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>get<span class="hljs-constructor">Property(<span class="hljs-string">&quot;java.io.tmpdir&quot;</span>)</span> + <span class="hljs-string">&quot;/result-files&quot;</span>;<br>        String zipPath = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>get<span class="hljs-constructor">Property(<span class="hljs-string">&quot;java.io.tmpdir&quot;</span>)</span>;<br>        <span class="hljs-keyword">for</span> (String path : paths) &#123;<br>            String localPath = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">GeneHubApi</span>.</span></span><span class="hljs-keyword">to</span><span class="hljs-constructor">LocalPath(<span class="hljs-params">path</span>, <span class="hljs-params">principal</span>.<span class="hljs-params">getInstitutionNo</span>()</span>);<br>            File file = <span class="hljs-keyword">new</span> <span class="hljs-constructor">File(<span class="hljs-params">localPath</span>)</span>;<br>            String temp = tempPath + localPath.substring(localPath.last<span class="hljs-constructor">IndexOf(<span class="hljs-params">analysisId</span>)</span> + analysisId.length<span class="hljs-literal">()</span>,<br>                    localPath.last<span class="hljs-constructor">IndexOf(<span class="hljs-string">&quot;/&quot;</span>)</span> + <span class="hljs-number">1</span>) + file.get<span class="hljs-constructor">Name()</span>;<br>            <span class="hljs-keyword">if</span> (file.is<span class="hljs-constructor">File()</span>) &#123;<br>                <span class="hljs-comment">// 传入文件 先生成其上层目录</span><br>                String tempDir = temp.substring(<span class="hljs-number">0</span>, temp.last<span class="hljs-constructor">IndexOf(<span class="hljs-string">&quot;/&quot;</span>)</span> + <span class="hljs-number">1</span>);<br>                File tempFile = <span class="hljs-keyword">new</span> <span class="hljs-constructor">File(<span class="hljs-params">tempDir</span>)</span>;<br>                tempFile.mkdirs<span class="hljs-literal">()</span>;<br>            &#125;<br>            <span class="hljs-comment">// 不论文件夹还是文件 都需要先在目标位置创建 否则Files.copy会报错</span><br>            File tempFile = <span class="hljs-keyword">new</span> <span class="hljs-constructor">File(<span class="hljs-params">temp</span>)</span>;<br>            <span class="hljs-keyword">if</span> (!tempFile.exists<span class="hljs-literal">()</span>) &#123;<br>                <span class="hljs-keyword">if</span> (file.is<span class="hljs-constructor">Directory()</span>) &#123;<br>                    tempFile.mkdirs<span class="hljs-literal">()</span>;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    tempFile.create<span class="hljs-constructor">NewFile()</span>;<br>                &#125;<br>            &#125;<br>            <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Files</span>.</span></span>copy(file.<span class="hljs-keyword">to</span><span class="hljs-constructor">Path()</span>, tempFile.<span class="hljs-keyword">to</span><span class="hljs-constructor">Path()</span>, StandardCopyOption.REPLACE_EXISTING);<br>        &#125;<br>        File tempFile = <span class="hljs-keyword">new</span> <span class="hljs-constructor">File(<span class="hljs-params">tempPath</span>)</span>;<br>        String zipName = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">FileUtil</span>.</span></span>compressed<span class="hljs-constructor">Files(<span class="hljs-params">tempFile</span>, <span class="hljs-params">zipPath</span>)</span>;<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">FileUtil</span>.</span></span>delete<span class="hljs-constructor">File(<span class="hljs-params">tempFile</span>)</span>;<br>        return zipName;<br>    &#125;<br><br>    @GET<br>    @<span class="hljs-constructor">Path(<span class="hljs-string">&quot;/package-files/&#123;fileName&#125;&quot;</span>)</span><br>    @<span class="hljs-constructor">Produces(MediaType.APPLICATION_OCTET_STREAM)</span><br>    public File download<span class="hljs-constructor">ResultFiles(@PathParam(<span class="hljs-string">&quot;fileName&quot;</span>)</span> String fileName) &#123;<br>        String localPath = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>get<span class="hljs-constructor">Property(<span class="hljs-string">&quot;java.io.tmpdir&quot;</span>)</span> + <span class="hljs-string">&quot;/&quot;</span> + fileName;<br>        return <span class="hljs-keyword">new</span> <span class="hljs-constructor">File(<span class="hljs-params">localPath</span>)</span>;<br>    &#125;<br><br>    public String get<span class="hljs-constructor">LocalPath(Integer <span class="hljs-params">usage</span>, String <span class="hljs-params">projectId</span>, String <span class="hljs-params">analysisId</span>)</span> &#123;<br>        GesourcePrincipal principal = context.get<span class="hljs-constructor">UserPrincipal()</span>;<br>        String databasePath = GENE_MATRIX_PATH + <span class="hljs-string">&quot;/&quot;</span> + projectId + <span class="hljs-string">&quot;/&quot;</span> + analysisId + <span class="hljs-string">&quot;/&quot;</span>;<br>        <span class="hljs-keyword">if</span> (usage.equals(GENEMTX_INPUT)) &#123;<br>            databasePath = databasePath + RESULT_FILES_SUFFIX;<br>        &#125;<br>        return <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">GeneHubApi</span>.</span></span><span class="hljs-keyword">to</span><span class="hljs-constructor">LocalPath(<span class="hljs-params">databasePath</span>, <span class="hljs-params">principal</span>.<span class="hljs-params">getInstitutionNo</span>()</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> static List&lt;AnalysisFile&gt; read<span class="hljs-constructor">AnalysisFiles(String <span class="hljs-params">deliveryPath</span>)</span> &#123;<br>        List&lt;AnalysisFile&gt; resultFiles = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;<span class="hljs-literal">()</span>;<br>        File deliveryFile = <span class="hljs-keyword">new</span> <span class="hljs-constructor">File(<span class="hljs-params">deliveryPath</span>)</span>;<br>        File<span class="hljs-literal">[]</span> files = deliveryFile.<span class="hljs-built_in">list</span><span class="hljs-constructor">Files()</span>;<br>        <span class="hljs-keyword">if</span> (files != null) &#123;<br>            <span class="hljs-keyword">for</span> (File file : files) &#123;<br>                AnalysisFile analysisFile = <span class="hljs-keyword">new</span> <span class="hljs-constructor">AnalysisFile()</span>;<br>                analysisFile.set<span class="hljs-constructor">FileName(<span class="hljs-params">file</span>.<span class="hljs-params">getName</span>()</span>);<br>                analysisFile.set<span class="hljs-constructor">DownloadPath(GeneHubApi.<span class="hljs-params">toGeneHubPath</span>(<span class="hljs-params">file</span>.<span class="hljs-params">getAbsolutePath</span>()</span>));<br>                <span class="hljs-keyword">if</span> (!file.is<span class="hljs-constructor">Hidden()</span>) &#123;<br>                    <span class="hljs-keyword">if</span> (file.is<span class="hljs-constructor">Directory()</span>) &#123;<br>                        analysisFile.set<span class="hljs-constructor">Dir(<span class="hljs-params">true</span>)</span>;<br>                        List&lt;AnalysisFile&gt; children = read<span class="hljs-constructor">AnalysisFiles(<span class="hljs-params">file</span>.<span class="hljs-params">getAbsolutePath</span>()</span>);<br>                        analysisFile.set<span class="hljs-constructor">Children(<span class="hljs-params">children</span>)</span>;<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        analysisFile.set<span class="hljs-constructor">Dir(<span class="hljs-params">false</span>)</span>;<br>                    &#125;<br>                    resultFiles.add(analysisFile);<br>                &#125;<br>            &#125;<br>        &#125;<br>        return resultFiles;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



  
</article>

              </div>
            </div>
          </div>
        </div>
      </div>
    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  







  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.1/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js" ></script>



  <script  src="/js/local-search.js" ></script>






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
